import{g as u,s as p}from"./index-CVhy_nTk.js";const l="https://strict-bellanca-subscribe-b294309e.koyeb.app";function C(){const i=u([]),o=u(!1),n=u(null),c=u([]),h=t=>{if(!t)return;const e=String(t).trim().toLowerCase().replace(/\s+/g,""),r={streaming:"streaming",video:"streaming",netflix:"streaming",hbo:"streaming",twitch:"streaming",youtube:"streaming",primevideo:"streaming",disneyplus:"streaming",music:"music",spotify:"music",applemusic:"music",games:"games",game:"games",gaming:"games",steam:"games",education:"education",study:"education",course:"education",health:"health",fitness:"health",sport:"health",work:"work",productivity:"work",tools:"work",finance:"financial",financial:"financial",bank:"financial",shopping:"shopping",shop:"shopping",store:"shopping",other:"other",misc:"other",miscellaneous:"other"};return r[e]?r[e]:new Set(["streaming","music","games","education","health","work","financial","shopping","other"]).has(e)?e:void 0},g=t=>{const e=t.billingDate??t.billing_date,r=e?new Date(e):void 0,a=r&&!isNaN(r.getTime())?r:void 0;return{id:t.id??(t._id?String(t._id):void 0),userId:String(t.userId??t.user_id??""),name:String(t.name??""),price:Number(t.price??0),currency:t.currency??"USD",cycle:t.cycle??"monthly",billingDate:a,reminderDays:t.reminderDays??3,category:h(t.serviceLogo??t.service_logo??t.category??t.name),createdAt:t.createdAt?new Date(t.createdAt):void 0,updatedAt:t.updatedAt?new Date(t.updatedAt):void 0}},y=p(()=>i.value.filter(t=>t.cycle==="monthly").reduce((t,e)=>t+e.price,0)),d=p(()=>i.value.filter(t=>t.cycle==="yearly").reduce((t,e)=>t+e.price,0)),m=p(()=>{const t=new Date,e=new Date(t.getTime()+10080*60*1e3);return i.value.filter(r=>{if(!r.billingDate)return!1;const a=new Date(r.billingDate);return a>=t&&a<=e}).sort((r,a)=>!r.billingDate||!a.billingDate?0:new Date(r.billingDate).getTime()-new Date(a.billingDate).getTime())});return{subscriptions:i,loading:o,error:n,monthlyTotal:y,yearlyTotal:d,upcomingPayments:m,fetchSubscriptions:async t=>{if(!t)return;o.value=!0,n.value=null;const e=new AbortController,r=setTimeout(()=>e.abort(),7e3);try{const a=await fetch(`${l}/subscriptions/${t}`,{signal:e.signal});if(!a.ok)throw new Error("Failed to fetch subscriptions");const s=await a.json();i.value=Array.isArray(s)?s.map(g):[]}catch(a){const s=a instanceof Error?a.message:"Failed to fetch subscriptions";n.value=s.includes("AbortError")?"Request timed out while loading":s,console.error("Error fetching subscriptions:",a)}finally{clearTimeout(r),o.value=!1}},createSubscription:async t=>{o.value=!0,n.value=null;try{const e={userId:t.userId,name:t.name,price:t.price,billingDate:t.billingDate instanceof Date?t.billingDate.toISOString():t.billingDate,serviceLogo:t.category},r=await fetch(`${l}/subscriptions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw new Error("Failed to create subscription");const a=g(await r.json());return i.value.push(a),a}catch(e){throw n.value=e instanceof Error?e.message:"Failed to create subscription",console.error("Error creating subscription:",e),e}finally{o.value=!1}},updateSubscription:async(t,e)=>{o.value=!0,n.value=null;try{const r={name:e.name,price:e.price,billingDate:e.billingDate instanceof Date?e.billingDate.toISOString():e.billingDate,serviceLogo:e.category};if(!(await fetch(`${l}/subscriptions/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)throw new Error("Failed to update subscription");const s=i.value.findIndex(f=>f.id===t);if(s!==-1){const{userId:f,...b}=e,v=g({...i.value[s],...b});i.value[s]=v}}catch(r){throw n.value=r instanceof Error?r.message:"Failed to update subscription",console.error("Error updating subscription:",r),r}finally{o.value=!1}},deleteSubscription:async t=>{o.value=!0,n.value=null;try{if(!(await fetch(`${l}/subscriptions/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete subscription");i.value=i.value.filter(r=>r.id!==t)}catch(e){throw n.value=e instanceof Error?e.message:"Failed to delete subscription",console.error("Error deleting subscription:",e),e}finally{o.value=!1}},getStats:async t=>{try{const e=await fetch(`${l}/subscriptions/${t}/stats`);if(!e.ok)throw new Error("Failed to fetch stats");return await e.json()}catch(e){return console.error("Error fetching stats:",e),{totalMonthly:0,totalYearly:0,count:0}}},categories:c,fetchCategories:async t=>{if(t){o.value=!0,n.value=null;try{const e=await fetch(`${l}/categories/${t}`);if(!e.ok)throw new Error("Failed to fetch categories");const r=await e.json();c.value=Array.isArray(r)?r:[]}catch(e){const r=e instanceof Error?e.message:"Failed to fetch categories";n.value=r,console.error("Error fetching categories:",e)}finally{o.value=!1}}},createCategory:async t=>{o.value=!0,n.value=null;try{const e=await fetch(`${l}/categories`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("Failed to create category");const r=await e.json();return c.value.push(r),r}catch(e){throw n.value=e instanceof Error?e.message:"Failed to create category",console.error("Error creating category:",e),e}finally{o.value=!1}},deleteCategory:async t=>{o.value=!0,n.value=null;try{if(!(await fetch(`${l}/categories/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete category");c.value=c.value.filter(r=>r.id!==t)}catch(e){throw n.value=e instanceof Error?e.message:"Failed to delete category",console.error("Error deleting category:",e),e}finally{o.value=!1}}}}export{C as u};
