import{d as se,g as D,h as W,i as ie,w as q,T as le,c as d,j as B,a as e,t as C,e as ee,F as X,k as G,n as H,l as z,v as Q,m as Y,p as te,q as ce,o as c,s as U,x as ue,f as O,y as T,u as de,r as me}from"./index-CVhy_nTk.js";import{u as ve}from"./useAuth-kWT0LHcZ.js";import{u as pe}from"./useSubscriptionsMongo-slzg13jB.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _={streaming:"hsl(120, 12%, 30%)",music:"hsl(120, 12%, 40%)",games:"hsl(120, 12%, 50%)",education:"hsl(120, 12%, 60%)",health:"hsl(120, 12%, 70%)",work:"hsl(120, 12%, 35%)",financial:"hsl(120, 12%, 45%)",shopping:"hsl(120, 12%, 55%)",other:"hsl(120, 12%, 65%)"},he={key:0,class:"fixed inset-0 bg-base z-50 flex flex-col",style:{"background-color":"var(--bg-base)"}},fe={class:"flex justify-between items-center p-4"},ge={class:"font-medium text-lg capitalize"},ye={class:"flex-grow overflow-y-auto px-6 pb-24"},be={key:0},xe={class:"space-y-2"},we=["onClick"],ke={class:"font-medium"},_e={key:1,class:"flex flex-col h-full"},Me={class:"text-center pt-8 pb-12 flex-shrink-0"},Se={class:"text-sm uppercase tracking-widest",style:{color:"var(--muted)"}},Ce={class:"flex items-center justify-center text-6xl font-light",style:{"font-family":"'Space Grotesk', monospace"}},De={class:"space-y-4 flex-shrink-0"},$e={class:"grid grid-cols-2 gap-4"},Le={key:0,class:"absolute bottom-0 left-0 right-0 p-4 bg-opacity-80 backdrop-blur-sm",style:{"background-color":"var(--bg-base)"}},Be={class:"flex gap-3"},Ae=se({__name:"SubscriptionModal",props:{show:{type:Boolean},subscription:{}},emits:["close","save","delete"],setup(P,{emit:x}){const f=P,M=x,g=D(1),S={name:"",price:0,currency:"USD",cycle:"monthly",billingDate:v(new Date),reminderDays:3,category:"other"},a=D({...S}),A=D(!1),u=D(0),y=D(0),i=n=>"touches"in n,m=n=>{A.value=!0,i(n)?u.value=n.touches[0]?.clientX??0:u.value=n.clientX,window.addEventListener("mousemove",w),window.addEventListener("touchmove",w),window.addEventListener("mouseup",r),window.addEventListener("touchend",r)},w=n=>{if(!A.value)return;const s=i(n)?n.touches[0]?.clientX??0:n.clientX,l=s-u.value,Z=l*.25,J=Number(a.value.price)+Number(Z);a.value.price=Math.max(0,Number(J.toFixed(2))),y.value+=l,u.value=s},r=()=>{A.value=!1,y.value=0,window.removeEventListener("mousemove",w),window.removeEventListener("touchmove",w),window.removeEventListener("mouseup",r),window.removeEventListener("touchend",r)},p=D([{id:"streaming",name:"Streaming",budget:0,color:_.streaming},{id:"music",name:"Music",budget:0,color:_.music},{id:"games",name:"Games",budget:0,color:_.games},{id:"education",name:"Education",budget:0,color:_.education},{id:"health",name:"Health",budget:0,color:_.health},{id:"work",name:"Productivity",budget:0,color:_.work},{id:"financial",name:"Finance",budget:0,color:_.financial},{id:"shopping",name:"Shopping",budget:0,color:_.shopping},{id:"other",name:"Other",budget:0,color:_.other}]),h=n=>n?{streaming:"Streaming",music:"Music",games:"Games",education:"Education",health:"Health",work:"Productivity",financial:"Finance",shopping:"Shopping",other:"Other"}[n]??"Other":"Other";function v(n){const s=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),F=String(n.getDate()).padStart(2,"0");return`${s}-${l}-${F}`}W(()=>f.show,n=>{if(n)if(f.subscription){const s=f.subscription.billingDate??f.subscription.billing_date,l=s?new Date(s):void 0,F=l&&!isNaN(l.getTime())?l:new Date;a.value={name:f.subscription.name,price:f.subscription.price,currency:f.subscription.currency,cycle:f.subscription.cycle,billingDate:v(F),reminderDays:f.subscription.reminderDays,category:f.subscription.category||"other"},g.value=2}else a.value={...S,billingDate:v(new Date)},g.value=1});const k=n=>{n&&(a.value.category=n,g.value=2)},L=()=>{g.value>1?g.value--:M("close")},$=()=>{M("close")},b=()=>{if(!a.value.name.trim()){alert("Please enter a subscription name.");return}if(a.value.price<=0){alert("Price must be greater than 0.");return}const n={...a.value,billingDate:new Date(a.value.billingDate)};M("save",n),$()},E=()=>{f.subscription?.id&&confirm("Are you sure you want to delete this subscription?")&&(M("delete",f.subscription.id),$())};return(n,s)=>(c(),ie(le,{name:"slide-up"},{default:q(()=>[f.show?(c(),d("div",he,[e("header",fe,[e("button",{onClick:L,class:"p-2 rounded-full transition-colors hover:bg-black/5"},[...s[4]||(s[4]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M15 18L9 12L15 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),e("h2",ge,C(g.value===1?"Add Subscription":h(a.value.category)),1),e("button",{onClick:$,class:"p-2 rounded-full transition-colors hover:bg-black/5"},[...s[5]||(s[5]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),e("main",ye,[g.value===1?(c(),d("div",be,[s[6]||(s[6]=e("h1",{class:"text-4xl font-bold mb-8"},[ee("Choose your"),e("br"),ee("category")],-1)),e("div",xe,[(c(!0),d(X,null,G(p.value,l=>(c(),d("button",{key:l.id,onClick:F=>k(l.id),class:"w-full text-left p-4 rounded-xl transition-colors flex items-center",style:H({backgroundColor:l.color,color:"var(--text-main)"})},[e("span",ke,C(l.name),1)],12,we))),128))])])):B("",!0),g.value===2?(c(),d("div",_e,[e("div",Me,[e("p",Se,C(h(a.value.category)),1),e("div",Ce,[s[7]||(s[7]=e("span",{class:"font-sans text-4xl align-middle mr-1"},"$",-1)),z(e("input",{type:"number","onUpdate:modelValue":s[0]||(s[0]=l=>a.value.price=l),step:"0.01",min:"0",required:"",class:"bg-transparent outline-none w-48 text-center",placeholder:"0.0"},null,512),[[Q,a.value.price,void 0,{number:!0}]])]),e("div",{class:"h-4 mt-4 cursor-ew-resize overflow-hidden",onMousedown:Y(m,["prevent"]),onTouchstart:Y(m,["prevent"])},[e("div",{class:te(["flex justify-center items-center h-full space-x-1",{"snap-back":!A.value}]),style:H({transform:`translateX(${y.value}px)`})},[(c(),d(X,null,G(51,l=>e("div",{key:l,class:te(["w-px h-full flex-shrink-0",l===26?"h-4":"h-2"]),style:{"background-color":"var(--muted)"}},null,2)),64))],6)],32)]),e("div",De,[e("div",null,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium text-[var(--muted)] mb-1"},"Subscription Name",-1)),z(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>a.value.name=l),type:"text",required:"",class:"form-input",placeholder:"e.g., Netflix"},null,512),[[Q,a.value.name]])]),e("div",$e,[e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium text-[var(--muted)] mb-1"},"Billing Cycle",-1)),z(e("select",{"onUpdate:modelValue":s[2]||(s[2]=l=>a.value.cycle=l),required:"",class:"form-input"},[...s[9]||(s[9]=[e("option",{value:"monthly"},"Monthly",-1),e("option",{value:"yearly"},"Yearly",-1)])],512),[[ce,a.value.cycle]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-sm font-medium text-[var(--muted)] mb-1"},"Next Bill",-1)),z(e("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>a.value.billingDate=l),type:"date",required:"",class:"form-input"},null,512),[[Q,a.value.billingDate]])])])])])):B("",!0)]),g.value===2?(c(),d("footer",Le,[e("div",Be,[P.subscription?(c(),d("button",{key:0,onClick:E,class:"flex-1 btn-secondary",style:{color:"var(--accent)"}},"Delete")):B("",!0),e("button",{onClick:b,class:"flex-1 btn-primary"},"Save Subscription")])])):B("",!0)])):B("",!0)]),_:1}))}}),Ee=oe(Ae,[["__scopeId","data-v-bf008294"]]),Ne={class:"relative w-full h-full"},Fe=["viewBox"],Ve=["transform"],Te=["x1","y1","x2","y2","stroke"],j=120,I=280,R=40,je=se({__name:"RadialChart",props:{subscriptions:{}},setup(P){const x=P,f=I/2-R-10,M=_,g=U(()=>{const u=x.subscriptions,y=new Array(j).fill(0);if(u&&u.length>0){const r=[],p=[...u].sort((h,v)=>h.price-v.price);p.forEach((h,v)=>{r.push({index:Math.floor(v/p.length*j),value:h.price})}),r.length>0&&r.push({index:j,value:r[0].value});for(let h=0;h<r.length-1;h++){const v=r[h],k=r[h+1];if(v&&k){const L=k.index-v.index,$=k.value-v.value;for(let b=v.index;b<k.index;b++){const E=L===0?1:(b-v.index)/L;y[b]=v.value+$*E}}}}const i=Math.max(...u.map(r=>r.price),1),m=y.map(r=>{const p=(Math.random()*.5+.75)*r;return Math.max(p,i*.02)}),w=Math.max(...m,1);return m.map((r,p)=>{const h=2*Math.PI/j*p-Math.PI/2,v=r/w*f,k=R+v,L=R*Math.cos(h),$=R*Math.sin(h),b=k*Math.cos(h),E=k*Math.sin(h),n=Math.hypot(b-L,E-$),s=A.value[p]??"other",l=M[s]||"var(--olive)";return{x1:L,y1:$,x2:b,y2:E,length:n,color:l}})}),S=u=>u.cycle==="monthly"?u.price:u.price/12,a=U(()=>{const u={};for(const y of x.subscriptions||[]){const i=y.category||"other";u[i]=(u[i]||0)+S(y)}return u}),A=U(()=>{const u=Object.entries(a.value).filter(([,m])=>m>0),y=u.reduce((m,[,w])=>m+w,0)||1,i=[];for(const[m,w]of u){const r=Math.max(1,Math.round(w/y*j));for(let p=0;p<r;p++)i.push(m)}return i.slice(0,j).concat(Array(Math.max(0,j-i.length)).fill("other"))});return(u,y)=>(c(),d("div",Ne,[(c(),d("svg",{viewBox:`0 0 ${I} ${I}`,class:"w-full h-full"},[e("g",{transform:`translate(${I/2}, ${I/2})`},[e("circle",{r:R,fill:"var(--olive-dark)"}),(c(!0),d(X,null,G(g.value,(i,m)=>(c(),d("g",{key:m},[e("line",{x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,stroke:i.color,"stroke-width":"2","stroke-linecap":"round",class:"bar-line",style:H({strokeDasharray:i.length,strokeDashoffset:i.length,animationDelay:`${m*12}ms`})},null,12,Te)]))),128))],8,Ve)],8,Fe))]))}}),ne=oe(je,[["__scopeId","data-v-d63ede34"]]),Oe={key:0,class:"loader-overlay"},Ue={class:"loader-inner"},Pe={class:"loader-chart"},Ie={class:"flex justify-between items-center mb-10"},Re={class:"w-10 h-10 rounded-full bg-gray-300"},He=["src"],ze={key:1,class:"w-10 h-10 rounded-full flex items-center justify-center",style:{"background-color":"var(--olive)"}},qe={key:0,class:"text-white font-medium text-lg"},Xe={class:"text-center mb-10"},Ge={class:"text-6xl font-light mt-2",style:{"font-family":"'Space Grotesk', monospace"}},Ye={class:"mb-10"},Ze={class:"w-full aspect-square"},Je={class:"space-y-4"},Ke={key:0,class:"text-center",style:{color:"var(--muted)"}},Qe={key:1,class:"text-center text-red-500"},We={key:2,class:"text-center",style:{color:"var(--muted)"}},et=["onClick"],tt={class:"text-white font-medium text-xl"},st={class:"flex-grow"},ot={class:"font-medium text-lg"},nt={class:"text-sm",style:{color:"var(--muted)"}},lt={class:"text-right"},at={class:"font-medium text-lg",style:{"font-family":"'Space Grotesk', monospace"}},rt={class:"text-xs",style:{color:"var(--muted)"}},it={class:"fixed right-0 top-0 h-full w-64 drawer-panel",style:{"background-color":"var(--bg-paper)","border-color":"var(--border)"}},ct={class:"menu-list"},ut=se({__name:"DashboardView",setup(P){const{user:x,logout:f}=ve(),{subscriptions:M,loading:g,error:S,fetchSubscriptions:a,createSubscription:A,updateSubscription:u,deleteSubscription:y}=pe(),i=D(!1),m=D(null),w=de(),r=D(!1),p=D("light"),h=D(!0),v=()=>{r.value=!r.value},k=o=>{document.documentElement.classList.toggle("theme-dark",o==="dark");const t=document.querySelector('meta[name="theme-color"]');if(t){const V=getComputedStyle(document.documentElement);t.setAttribute("content",V.getPropertyValue("--bg-page").trim())}},L=()=>{p.value=p.value==="dark"?"light":"dark",localStorage.setItem("theme",p.value),k(p.value)};U(()=>p.value==="dark"?"On":"Off");const $=async()=>{try{await f(),w.push("/")}catch(o){console.error("Logout failed",o)}finally{r.value=!1}},b=U(()=>[...M.value].sort((o,t)=>t.price-o.price)),E=U(()=>M.value.reduce((o,t)=>t.cycle==="monthly"?o+t.price:t.cycle==="yearly"?o+t.price/12:o,0)),n=o=>new Intl.NumberFormat("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}).format(o),s=o=>{const t=new Date(o);return isNaN(t.getTime())?"Date not set":`Next on ${new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(t)}`},l=o=>{const t={streaming:"Streaming",music:"Music",games:"Games",education:"Education",health:"Health",work:"Productivity",financial:"Finance",shopping:"Shopping",other:"Other"};return o&&o in t?t[o]??"Other":"Other"},F=o=>_[o||"other"]||_.other,Z=()=>{m.value=null,i.value=!0},J=o=>{m.value=o,i.value=!0},K=()=>{i.value=!1,m.value=null},ae=async o=>{try{const t=x.value?.uid||void 0;if(!t){S.value="You must be logged in.";return}m.value?.id?await u(m.value.id,o):await A({...o,userId:t}),await a(t),K()}catch(t){console.error("Failed to save subscription:",t),S.value="Failed to save subscription."}},re=async o=>{try{const t=x.value?.uid||void 0;if(!t){S.value="You must be logged in.";return}await y(o),await a(t),K()}catch(t){console.error("Failed to delete subscription:",t),S.value="Failed to delete subscription."}};return ue(()=>{const o=localStorage.getItem("theme")||"light";p.value=o,k(o),W(x,t=>{const V=t?.uid||void 0;V?a(V):M.value=[]},{immediate:!0}),W([g,M],([t])=>{t?h.value=!0:setTimeout(()=>{h.value=!1},400)},{immediate:!0})}),(o,t)=>{const V=me("router-link");return c(),d("div",{class:"min-h-screen p-6",style:H([{"background-color":"var(--bg-page)",color:"var(--text-main)"},{transition:"transform 0.25s ease"}])},[h.value?(c(),d("div",Oe,[e("div",Ue,[e("div",Pe,[O(ne,{subscriptions:b.value},null,8,["subscriptions"])]),t[0]||(t[0]=e("div",{class:"loader-title"},"SubScribe",-1))])])):B("",!0),e("header",Ie,[e("div",Re,[T(x)?.photoURL?(c(),d("img",{key:0,src:T(x).photoURL,alt:"User Avatar",class:"w-full h-full rounded-full object-cover"},null,8,He)):(c(),d("div",ze,[T(x)?.email?(c(),d("span",qe,C(T(x).email.charAt(0).toUpperCase()),1)):B("",!0)]))]),e("div",{class:"relative"},[e("button",{onClick:v,class:"p-2 rounded-full transition-colors hover:bg-black/5"},[...t[1]||(t[1]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"stroke-current"},[e("path",{d:"M4 6H20M4 12H20M4 18H20","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])])]),e("main",null,[e("section",Xe,[t[3]||(t[3]=e("p",{class:"text-sm uppercase tracking-widest font-medium",style:{color:"var(--muted)"}},"Monthly Total",-1)),e("p",Ge,[t[2]||(t[2]=e("span",{class:"font-sans text-4xl align-middle"},"$",-1)),ee(C(n(E.value)),1)])]),e("section",Ye,[e("div",Ze,[O(ne,{subscriptions:b.value},null,8,["subscriptions"])])]),e("section",null,[e("div",Je,[T(g)?(c(),d("div",Ke,"Loading...")):T(S)?(c(),d("div",Qe,C(T(S)),1)):b.value.length===0?(c(),d("div",We,"You don't have any subscriptions yet.")):B("",!0),(c(!0),d(X,null,G(b.value,N=>(c(),d("div",{key:N.id,class:"flex items-center",onClick:dt=>J(N)},[e("div",{class:"w-12 h-12 rounded-lg flex items-center justify-center mr-4",style:H({backgroundColor:F(N.category)})},[e("span",tt,C(N.name.charAt(0).toUpperCase()),1)],4),e("div",st,[e("p",ot,C(N.name),1),e("p",nt,C(l(N.category)),1)]),e("div",lt,[e("p",at,"$"+C(n(N.price)),1),e("p",rt,C(s(N.billingDate)),1)])],8,et))),128))])])]),O(le,{name:"drawer"},{default:q(()=>[r.value?(c(),d("div",{key:0,class:"fixed inset-0 z-50",onClick:Y(v,["self"]),style:{"background-color":"transparent"}},[e("aside",it,[t[10]||(t[10]=e("div",{class:"menu-header"},"MENU",-1)),e("nav",ct,[O(V,{to:"/settings",onClick:v,class:"menu-item"},{default:q(()=>[...t[4]||(t[4]=[e("svg",{class:"menu-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 8a4 4 0 1 0 0 8a4 4 0 0 0 0-8m8.14 4a6.14 6.14 0 0 1-.08 1l2.11 1.65a.5.5 0 0 1 .11.66l-2 3.46a.5.5 0 0 1-.62.22l-2.49-1a7.12 7.12 0 0 1-1.73 1l-.38 2.65a.5.5 0 0 1-.5.42h-4a.5.5 0 0 1-.5-.42l-.38-2.65a7.12 7.12 0 0 1-1.73-1l-2.49 1a.5.5 0 0 1-.62-.22l-2-3.46a.5.5 0 0 1 .11-.66L3.94 13a6.14 6.14 0 0 1 0-2L1.83 9.35a.5.5 0 0 1-.11-.66l2-3.46a.5.5 0 0 1 .62-.22l2.49 1a7.12 7.12 0 0 1 1.73-1l.38-2.65a.5.5 0 0 1 .5-.42h4a.5.5 0 0 1 .5.42l.38 2.65a7.12 7.12 0 0 1 1.73 1l2.49-1a.5.5 0 0 1 .62.22l2 3.46a.5.5 0 0 1-.11.66Z"})],-1),e("span",null,"Settings",-1)])]),_:1}),O(V,{to:"/app-info",onClick:v,class:"menu-item"},{default:q(()=>[...t[5]||(t[5]=[e("svg",{class:"menu-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M11 17h2v-6h-2v6m1-12A10 10 0 1 0 22 15A10 10 0 0 0 12 5m0 14A8 8 0 1 1 20 11A8 8 0 0 1 12 19m0-8a1 1 0 1 0-1-1a1 1 0 0 0 1 1"})],-1),e("span",null,"App Info",-1)])]),_:1}),e("button",{onClick:L,class:"menu-item"},[t[7]||(t[7]=e("svg",{class:"menu-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 2a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0V3a1 1 0 0 1 1-1m7 10a7 7 0 1 1-7-7a7 7 0 0 1 7 7m-7 9a1 1 0 0 1-1-1v-2a1 1 0 1 1 2 0v2a1 1 0 0 1-1 1M3 13a1 1 0 0 1-1-1v0a1 1 0 1 1 2 0v0a1 1 0 0 1-1 1m18 0a1 1 0 0 1-1-1v0a1 1 0 1 1 2 0v0a1 1 0 0 1-1 1M5.64 6.05a1 1 0 0 1 1.41 0l1.41 1.41a1 1 0 1 1-1.41 1.41L5.64 7.46a1 1 0 0 1 0-1.41m11.3 11.3a1 1 0 0 1 1.41 0l1.41 1.41a1 1 0 0 1-1.41 1.41l-1.41-1.41a1 1 0 0 1 0-1.41"})],-1)),t[8]||(t[8]=e("span",null,"Dark Mode",-1)),e("span",{class:te(["menu-switch",{on:p.value==="dark"}])},[...t[6]||(t[6]=[e("i",null,null,-1)])],2)])]),t[11]||(t[11]=e("div",{class:"menu-sep"},null,-1)),e("button",{onClick:$,class:"menu-item logout"},[...t[9]||(t[9]=[e("svg",{class:"menu-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M14.08 15.59L16.67 13H7v-2h9.67l-2.59-2.59L15.5 7l5 5l-5 5l-1.42-1.41M3 19V5h8v2H5v10h6v2H3Z"})],-1),e("span",null,"Logout",-1)])])])])):B("",!0)]),_:1}),e("button",{onClick:Y(Z,["stop","prevent"]),class:"fixed bottom-8 left-1/2 -translate-x-1/2 w-16 h-16 text-white rounded-full flex items-center justify-center transition-transform duration-200 hover:scale-110 z-50",style:{"background-color":"var(--accent)"}},[...t[12]||(t[12]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v12m6-6H6"})],-1)])]),O(Ee,{show:i.value,subscription:m.value,onClose:K,onSave:ae,onDelete:re},null,8,["show","subscription"])])}}}),ft=oe(ut,[["__scopeId","data-v-b4c5c8cf"]]);export{ft as default};
