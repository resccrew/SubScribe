import{d as K,r as C,w as Z,f as oe,g as J,T as ee,c as d,h as F,a as e,t as D,e as T,F as q,i as O,n as R,j as X,v as Y,k as H,l as W,m as ne,o as u,p as z,q as le,s as I,x as E,u as re,y as ae}from"./index-Da3oJxeQ.js";import{u as ie}from"./useAuth-4u8PwluR.js";import{u as ce}from"./useSubscriptionsMongo-CIVDhvot.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={key:0,class:"fixed inset-0 bg-base z-50 flex flex-col",style:{"background-color":"var(--bg-base)"}},de={class:"flex justify-between items-center p-4"},me={class:"font-medium text-lg capitalize"},pe={class:"flex-grow overflow-y-auto px-6 pb-24"},he={key:0},ve={class:"space-y-2"},fe=["onClick"],ge={class:"font-medium"},ye={key:1,class:"flex flex-col h-full"},be={class:"text-center pt-8 pb-12 flex-shrink-0"},xe={class:"text-sm uppercase tracking-widest",style:{color:"var(--muted)"}},we={class:"flex items-center justify-center text-6xl font-light",style:{"font-family":"'Space Grotesk', monospace"}},ke={class:"space-y-4 flex-shrink-0"},_e={class:"grid grid-cols-2 gap-4"},Me={key:0,class:"absolute bottom-0 left-0 right-0 p-4 bg-opacity-80 backdrop-blur-sm",style:{"background-color":"var(--bg-base)"}},De={class:"flex gap-3"},Se=K({__name:"SubscriptionModal",props:{show:{type:Boolean},subscription:{}},emits:["close","save","delete"],setup(V,{emit:b}){const v=V,S=b,y=C(1),k={name:"",price:0,currency:"USD",cycle:"monthly",billingDate:p(new Date),reminderDays:3,category:"other"},r=C({...k}),$=C(!1),c=C(0),g=C(0),a=o=>"touches"in o,m=o=>{$.value=!0,a(o)?c.value=o.touches[0]?.clientX??0:c.value=o.clientX,window.addEventListener("mousemove",x),window.addEventListener("touchmove",x),window.addEventListener("mouseup",l),window.addEventListener("touchend",l)},x=o=>{if(!$.value)return;const s=a(o)?o.touches[0]?.clientX??0:o.clientX,i=s-c.value,U=i*.25,G=Number(r.value.price)+Number(U);r.value.price=Math.max(0,Number(G.toFixed(2))),g.value+=i,c.value=s},l=()=>{$.value=!1,g.value=0,window.removeEventListener("mousemove",x),window.removeEventListener("touchmove",x),window.removeEventListener("mouseup",l),window.removeEventListener("touchend",l)},f=C([{id:"streaming",name:"Streaming",budget:0,color:"hsl(120, 12%, 30%)"},{id:"music",name:"Music",budget:0,color:"hsl(120, 12%, 40%)"},{id:"games",name:"Games",budget:0,color:"hsl(120, 12%, 50%)"},{id:"education",name:"Education",budget:0,color:"hsl(120, 12%, 60%)"},{id:"health",name:"Health",budget:0,color:"hsl(120, 12%, 70%)"},{id:"work",name:"Productivity",budget:0,color:"hsl(120, 12%, 35%)"},{id:"financial",name:"Finance",budget:0,color:"hsl(120, 12%, 45%)"},{id:"shopping",name:"Shopping",budget:0,color:"hsl(120, 12%, 55%)"},{id:"other",name:"Other",budget:0,color:"hsl(120, 12%, 65%)"}]);function p(o){const s=o.getFullYear(),i=String(o.getMonth()+1).padStart(2,"0"),j=String(o.getDate()).padStart(2,"0");return`${s}-${i}-${j}`}Z(()=>v.show,o=>{o&&(v.subscription?(r.value={name:v.subscription.name,price:v.subscription.price,currency:v.subscription.currency,cycle:v.subscription.cycle,billingDate:p(new Date(v.subscription.billingDate)),reminderDays:v.subscription.reminderDays,category:v.subscription.category||"other"},y.value=2):(r.value={...k,billingDate:p(new Date)},y.value=1))});const h=o=>{o&&(r.value.category=o,y.value=2)},_=()=>{y.value>1?y.value--:S("close")},w=()=>{S("close")},L=()=>{if(!r.value.name.trim()){alert("Please enter a subscription name.");return}if(r.value.price<=0){alert("Price must be greater than 0.");return}const o={...r.value,billingDate:new Date(r.value.billingDate)};S("save",o),w()},M=()=>{v.subscription?.id&&confirm("Are you sure you want to delete this subscription?")&&(S("delete",v.subscription.id),w())};return(o,s)=>(u(),oe(ee,{name:"slide-up"},{default:J(()=>[v.show?(u(),d("div",ue,[e("header",de,[e("button",{onClick:_,class:"p-2 rounded-full transition-colors hover:bg-black/5"},[...s[4]||(s[4]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M15 18L9 12L15 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),e("h2",me,D(y.value===1?"Add Subscription":r.value.category),1),e("button",{onClick:w,class:"p-2 rounded-full transition-colors hover:bg-black/5"},[...s[5]||(s[5]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),e("main",pe,[y.value===1?(u(),d("div",he,[s[6]||(s[6]=e("h1",{class:"text-4xl font-bold mb-8"},[T("Choose your"),e("br"),T("category")],-1)),e("div",ve,[(u(!0),d(q,null,O(f.value,i=>(u(),d("button",{key:i.id,onClick:j=>h(i.id),class:"w-full text-left p-4 rounded-xl transition-colors flex items-center",style:R({backgroundColor:i.color,color:"var(--text-main)"})},[e("span",ge,D(i.name),1)],12,fe))),128))])])):F("",!0),y.value===2?(u(),d("div",ye,[e("div",be,[e("p",xe,D(r.value.category),1),e("div",we,[s[7]||(s[7]=e("span",{class:"font-sans text-4xl align-middle mr-1"},"$",-1)),X(e("input",{type:"number","onUpdate:modelValue":s[0]||(s[0]=i=>r.value.price=i),step:"0.01",min:"0",required:"",class:"bg-transparent outline-none w-48 text-center",placeholder:"0.0"},null,512),[[Y,r.value.price,void 0,{number:!0}]])]),e("div",{class:"h-4 mt-4 cursor-ew-resize overflow-hidden",onMousedown:H(m,["prevent"]),onTouchstart:H(m,["prevent"])},[e("div",{class:W(["flex justify-center items-center h-full space-x-1",{"snap-back":!$.value}]),style:R({transform:`translateX(${g.value}px)`})},[(u(),d(q,null,O(51,i=>e("div",{key:i,class:W(["w-px h-full flex-shrink-0",i===26?"h-4":"h-2"]),style:{"background-color":"var(--muted)"}},null,2)),64))],6)],32)]),e("div",ke,[e("div",null,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium text-[var(--muted)] mb-1"},"Subscription Name",-1)),X(e("input",{"onUpdate:modelValue":s[1]||(s[1]=i=>r.value.name=i),type:"text",required:"",class:"form-input",placeholder:"e.g., Netflix"},null,512),[[Y,r.value.name]])]),e("div",_e,[e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium text-[var(--muted)] mb-1"},"Billing Cycle",-1)),X(e("select",{"onUpdate:modelValue":s[2]||(s[2]=i=>r.value.cycle=i),required:"",class:"form-input"},[...s[9]||(s[9]=[e("option",{value:"monthly"},"Monthly",-1),e("option",{value:"yearly"},"Yearly",-1)])],512),[[ne,r.value.cycle]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-sm font-medium text-[var(--muted)] mb-1"},"Next Bill",-1)),X(e("input",{"onUpdate:modelValue":s[3]||(s[3]=i=>r.value.billingDate=i),type:"date",required:"",class:"form-input"},null,512),[[Y,r.value.billingDate]])])])])])):F("",!0)]),y.value===2?(u(),d("footer",Me,[e("div",De,[V.subscription?(u(),d("button",{key:0,onClick:M,class:"flex-1 btn-secondary",style:{color:"var(--accent)"}},"Delete")):F("",!0),e("button",{onClick:L,class:"flex-1 btn-primary"},"Save Budget")])])):F("",!0)])):F("",!0)]),_:1}))}}),Ce=Q(Se,[["__scopeId","data-v-777609bf"]]),$e={class:"relative w-full h-full"},Le=["viewBox"],Be=["transform"],Fe=["x1","y1","x2","y2","stroke"],N=120,A=280,P=40,je=K({__name:"RadialChart",props:{subscriptions:{}},setup(V){const b=V,v=A/2-P-10,S={streaming:"hsl(120, 12%, 30%)",music:"hsl(120, 12%, 40%)",games:"hsl(120, 12%, 50%)",education:"hsl(120, 12%, 60%)",health:"hsl(120, 12%, 70%)",work:"hsl(120, 12%, 35%)",financial:"hsl(120, 12%, 45%)",shopping:"hsl(120, 12%, 55%)",other:"hsl(120, 12%, 65%)"},y=z(()=>{const c=b.subscriptions,g=new Array(N).fill(0);if(c&&c.length>0){const l=[],f=[...c].sort((p,h)=>p.price-h.price);f.forEach((p,h)=>{l.push({index:Math.floor(h/f.length*N),value:p.price})}),l.length>0&&l.push({index:N,value:l[0].value});for(let p=0;p<l.length-1;p++){const h=l[p],_=l[p+1];if(h&&_){const w=_.index-h.index,L=_.value-h.value;for(let M=h.index;M<_.index;M++){const o=w===0?1:(M-h.index)/w;g[M]=h.value+L*o}}}}const a=Math.max(...c.map(l=>l.price),1),m=g.map(l=>{const f=(Math.random()*.5+.75)*l;return Math.max(f,a*.02)}),x=Math.max(...m,1);return m.map((l,f)=>{const p=2*Math.PI/N*f-Math.PI/2,h=l/x*v,_=P+h,w=P*Math.cos(p),L=P*Math.sin(p),M=_*Math.cos(p),o=_*Math.sin(p),s=Math.hypot(M-w,o-L),i=$.value[f]??"other",j=S[i]||"var(--olive)";return{x1:w,y1:L,x2:M,y2:o,length:s,color:j}})}),k=c=>c.cycle==="monthly"?c.price:c.price/12,r=z(()=>{const c={};for(const g of b.subscriptions||[]){const a=g.category||"other";c[a]=(c[a]||0)+k(g)}return c}),$=z(()=>{const c=Object.entries(r.value).filter(([,m])=>m>0),g=c.reduce((m,[,x])=>m+x,0)||1,a=[];for(const[m,x]of c){const l=Math.max(1,Math.round(x/g*N));for(let f=0;f<l;f++)a.push(m)}return a.slice(0,N).concat(Array(Math.max(0,N-a.length)).fill("other"))});return(c,g)=>(u(),d("div",$e,[(u(),d("svg",{viewBox:`0 0 ${A} ${A}`,class:"w-full h-full"},[e("g",{transform:`translate(${A/2}, ${A/2})`},[e("circle",{r:P,fill:"var(--olive-dark)"}),(u(!0),d(q,null,O(y.value,(a,m)=>(u(),d("g",{key:m},[e("line",{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,stroke:a.color,"stroke-width":"2","stroke-linecap":"round",class:"bar-line",style:R({strokeDasharray:a.length,strokeDashoffset:a.length,animationDelay:`${m*12}ms`})},null,12,Fe)]))),128))],8,Be)],8,Le))]))}}),Ee=Q(je,[["__scopeId","data-v-89d44cc7"]]),Ne={class:"flex justify-between items-center mb-10"},Ve={class:"w-10 h-10 rounded-full bg-gray-300"},Ue=["src"],Ae={key:1,class:"w-10 h-10 rounded-full flex items-center justify-center",style:{"background-color":"var(--olive)"}},Pe={key:0,class:"text-white font-medium text-lg"},ze={class:"text-center mb-10"},Re={class:"text-6xl font-light mt-2",style:{"font-family":"'Space Grotesk', monospace"}},Xe={class:"mb-10"},Ie={class:"w-full aspect-square"},Te={class:"space-y-4"},qe={key:0,class:"text-center",style:{color:"var(--muted)"}},Oe={key:1,class:"text-center text-red-500"},He={key:2,class:"text-center",style:{color:"var(--muted)"}},Ge=["onClick"],Ye={class:"text-white font-medium text-xl"},Je={class:"flex-grow"},Ke={class:"font-medium text-lg"},Qe={class:"text-sm",style:{color:"var(--muted)"}},We={class:"text-right"},Ze={class:"font-medium text-lg",style:{"font-family":"'Space Grotesk', monospace"}},et={class:"text-xs",style:{color:"var(--muted)"}},tt={class:"fixed right-0 top-0 h-full w-28 border-l",style:{"background-color":"var(--bg-page)","border-color":"var(--border)"}},st={class:"p-4 space-y-2"},ot=K({__name:"DashboardView",setup(V){const{user:b,logout:v}=ie(),{subscriptions:S,loading:y,error:k,fetchSubscriptions:r,createSubscription:$,updateSubscription:c,deleteSubscription:g}=ce(),a=C(!1),m=C(null),x=re(),l=C(!1),f=()=>{l.value=!l.value},p=async()=>{try{await v(),x.push("/")}catch(n){console.error("Logout failed",n)}finally{l.value=!1}},h=z(()=>[...S.value].sort((n,t)=>t.price-n.price)),_=z(()=>S.value.reduce((n,t)=>t.cycle==="monthly"?n+t.price:t.cycle==="yearly"?n+t.price/12:n,0)),w=n=>new Intl.NumberFormat("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}).format(n),L=n=>{const t=new Date(n);return`Next on ${new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(t)}`},M=n=>{const t={streaming:"Streaming",music:"Music",games:"Games",education:"Education",health:"Health",work:"Productivity",financial:"Finance",shopping:"Shopping",other:"Other"};return n&&n in t?t[n]??"Other":"Other"},o={streaming:"hsl(120, 12%, 30%)",music:"hsl(120, 12%, 40%)",games:"hsl(120, 12%, 50%)",education:"hsl(120, 12%, 60%)",health:"hsl(120, 12%, 70%)",work:"hsl(120, 12%, 35%)",financial:"hsl(120, 12%, 45%)",shopping:"hsl(120, 12%, 55%)",other:"hsl(120, 12%, 65%)"},s=n=>{const t=n||"other";return t in o?o[t]??"var(--olive-dark)":"var(--olive-dark)"},i=()=>{m.value=null,a.value=!0},j=n=>{m.value=n,a.value=!0},U=()=>{a.value=!1,m.value=null},G=async n=>{try{const t=b.value?.uid;if(!t){k.value="You must be logged in.";return}m.value?.id?await c(m.value.id,n):await $({...n,userId:t}),await r(t),U()}catch(t){console.error("Failed to save subscription:",t),k.value="Failed to save subscription."}},te=async n=>{try{const t=b.value?.uid;if(!t){k.value="You must be logged in.";return}await g(n),await r(t),U()}catch(t){console.error("Failed to delete subscription:",t),k.value="Failed to delete subscription."}};return le(()=>{Z(b,n=>{n?.uid?r(n.uid):S.value=[]},{immediate:!0})}),(n,t)=>{const se=ae("router-link");return u(),d("div",{class:"min-h-screen p-6",style:R([{"background-color":"var(--bg-page)",color:"var(--text-main)"},{transform:l.value?"translateX(-7rem)":"none",transition:"transform 0.25s ease",paddingRight:l.value?"0":void 0}])},[e("header",Ne,[e("div",Ve,[E(b)?.photoURL?(u(),d("img",{key:0,src:E(b).photoURL,alt:"User Avatar",class:"w-full h-full rounded-full object-cover"},null,8,Ue)):(u(),d("div",Ae,[E(b)?.email?(u(),d("span",Pe,D(E(b).email.charAt(0).toUpperCase()),1)):F("",!0)]))]),e("div",{class:"relative"},[e("button",{onClick:f,class:"p-2 rounded-full transition-colors hover:bg-black/5"},[...t[0]||(t[0]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"stroke-current"},[e("path",{d:"M4 6H20M4 12H20M4 18H20","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])])]),e("main",null,[e("section",ze,[t[2]||(t[2]=e("p",{class:"text-sm uppercase tracking-widest font-medium",style:{color:"var(--muted)"}},"Total a month",-1)),e("p",Re,[t[1]||(t[1]=e("span",{class:"font-sans text-4xl align-middle"},"$",-1)),T(D(w(_.value)),1)])]),e("section",Xe,[e("div",Ie,[I(Ee,{subscriptions:h.value},null,8,["subscriptions"])])]),e("section",null,[e("div",Te,[E(y)?(u(),d("div",qe,"Загрузка...")):E(k)?(u(),d("div",Oe,D(E(k)),1)):h.value.length===0?(u(),d("div",He,"У вас пока нет подписок.")):F("",!0),(u(!0),d(q,null,O(h.value,B=>(u(),d("div",{key:B.id,class:"flex items-center",onClick:nt=>j(B)},[e("div",{class:"w-12 h-12 rounded-lg flex items-center justify-center mr-4",style:R({backgroundColor:s(B.category)})},[e("span",Ye,D(B.name.charAt(0).toUpperCase()),1)],4),e("div",Je,[e("p",Ke,D(B.name),1),e("p",Qe,D(M(B.category)),1)]),e("div",We,[e("p",Ze,"$"+D(w(B.price)),1),e("p",et,D(L(B.billingDate)),1)])],8,Ge))),128))])])]),I(ee,{name:"drawer"},{default:J(()=>[l.value?(u(),d("div",{key:0,class:"fixed inset-0 z-50",onClick:H(f,["self"]),style:{"background-color":"transparent"}},[e("div",tt,[e("div",st,[t[4]||(t[4]=e("p",{class:"text-sm uppercase tracking-widest font-medium",style:{color:"var(--muted)"}},"Menu",-1)),I(se,{to:"/settings",onClick:f,class:"menu-item"},{default:J(()=>[...t[3]||(t[3]=[T("Settings",-1)])]),_:1}),t[5]||(t[5]=e("div",{class:"border-t my-2",style:{"border-color":"var(--border)"}},null,-1)),e("button",{onClick:p,class:"menu-item text-left",style:{color:"var(--accent)"}},"Logout")])])])):F("",!0)]),_:1}),e("button",{onClick:H(i,["stop","prevent"]),class:"fixed bottom-8 left-1/2 -translate-x-1/2 w-16 h-16 text-white rounded-full flex items-center justify-center transition-transform duration-200 hover:scale-110 z-50",style:{"background-color":"var(--accent)"}},[...t[6]||(t[6]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v12m6-6H6"})],-1)])]),I(Ce,{show:a.value,subscription:m.value,onClose:U,onSave:G,onDelete:te},null,8,["show","subscription"])],4)}}}),ct=Q(ot,[["__scopeId","data-v-37ff28b3"]]);export{ct as default};
